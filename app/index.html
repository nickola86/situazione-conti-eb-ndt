<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Lista Movimenti</title>
    <style>
	  *{padding:0;border:0;margin:0; font-family:sans-serif}
	  body{padding:10px;}
	  td,th{margin:5px;border: 1px solid black;padding: 5px 10px 5px 5px;}
	  th{background-color:#ffffaa}
	  select{margin:10px 0px 30px 0px;}
	  li{padding:left:30px;list-style-type:none}
	  button,select{font-size:1.2em;padding:10px 20px 10px 20px;border:1px solid #aaa}
    </style>
  </head>
  <body>
	<!--<select id="listUsers"></select>-->
	<!--<button type="button" onclick="refresh()">Aggiorna</button>-->
	<div id="displaydata" style="display:none">
		<b>Lista Movimenti</b><br/>
		<!-- Totaloni...
		<ul>
			<li><b style="white-space:nowrap" >Tempo totale di attività : </b> <span style="white-space:nowrap" id="totActive"></span></li>
			<li><b style="white-space:nowrap" >Tempo totale di inattività : </b> <span style="white-space:nowrap" id="totInactive"></span></li>
			<li><b style="white-space:nowrap" >Tempo dall'ultimo evento di <span id="lastEventType"></span> : </b> <span style="white-space:nowrap" id="lastEventElapsed"></span></li>
		<ul>
		<br/>
		-->
		<!--<div id="piechart" style="width: 400px; height: 200px;"></div><br/>-->
		<table>
			<thead>
				<th>Data</th>
				<th>Descrizione</th>
				<th>Tipo operazione</th>
				<th>Importo</th>
				<th>Utente</th>
			</thead>
			<tbody id="listMovimenti">
				<td></td><td></td><td></td><td></td><td></td>
			</tbody>
		</table>
	</div>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script>
		$(document).ready(function(){		
			refresh();
		});
		function refresh(){
			$.get("/api/movimenti").then(function(data){
				$("#listMovimenti").html("");
				var totActive = 0;
				var totInactive = 0;
				var i = 0;
				for(i = 0; i < data.length ; i++){
					var $tr = $("<tr/>");
					var $td = $("<td style='white-space:nowrap'/>");
					$td.text(data[i].data);
					$tr.append($td);
					$td = $("<td/>");
					$td.text(data[i].descrizione);
					$tr.append($td);
					$td = $("<td/>");
					$td.text(data[i].tipoOperazione);
					$tr.append($td);
					$td = $("<td/>");
					$td.text(formatImporto(data[i].importo));
					$tr.append($td);
					$td = $("<td/>");
					$td.text(data[i].utente.nome);
					$tr.append($td);
					$("#listMovimenti").append($tr);
				}
				
				//drawChart(totActive/1000/60/60,totInactive/1000/60/60);
				
				$("#displaydata").show();
			});
		}
		function utcToLocalDateTime(date){
			var d = new Date(date);
			mm = '' + (d.getMonth() + 1),
			dd = '' + d.getDate(),
			yyyy = d.getFullYear();
			hh24 = '' + d.getHours();
			mi = '' + d.getMinutes();
			ss = '' + d.getSeconds();
			if (mm.length < 2) mm = '0' + mm;
			if (dd.length < 2) dd = '0' + dd;
			if (hh24.length < 2) hh24 = '0' + hh24;
			if (mi.length < 2) mi = '0' + mi;
			if (ss.length < 2) ss = '0' + ss;
			return [dd,mm,yyyy].join('/') + " " + [hh24,mi,ss].join(':');
		}
		function utcToLocalTime(date){
			var d = new Date(date);
			mm = '' + (d.getMonth() + 1),
			dd = '' + d.getDate(),
			yyyy = d.getFullYear();
			hh24 = '' + d.getHours();
			mi = '' + d.getMinutes();
			ss = '' + d.getSeconds();
			if (mm.length < 2) mm = '0' + mm;
			if (dd.length < 2) dd = '0' + dd;
			if (hh24.length < 2) hh24 = '0' + hh24;
			if (mi.length < 2) mi = '0' + mi;
			if (ss.length < 2) ss = '0' + ss;
			return [hh24,mi,ss].join(':');
		}
		function utcToLocalDate(date){
			var d = new Date(date);
			mm = '' + (d.getMonth() + 1),
			dd = '' + d.getDate(),
			yyyy = d.getFullYear();
			hh24 = '' + d.getHours();
			mi = '' + d.getMinutes();
			ss = '' + d.getSeconds();
			if (mm.length < 2) mm = '0' + mm;
			if (dd.length < 2) dd = '0' + dd;
			if (hh24.length < 2) hh24 = '0' + hh24;
			if (mi.length < 2) mi = '0' + mi;
			if (ss.length < 2) ss = '0' + ss;
			return [dd,mm,yyyy].join('/');
		}
		function elapsedToHHMMSS(elapsed){
			var d = new Date(elapsed);
			hh24 = '' + (d.getHours()-1);
			mi = '' + d.getMinutes();
			ss = '' + d.getSeconds();
			if (hh24.length < 2) hh24 = '0' + hh24;
			if (mi.length < 2) mi = '0' + mi;
			if (ss.length < 2) ss = '0' + ss;
			return [hh24,mi,ss].join(':');
		}
		function notify(message) {
		  if (Notification.permission !== "granted")
			Notification.requestPermission().then(function(){notify(message)});
		  else {
			var notification = new Notification('Controllo timbrature', {
			  icon: 'https://cdn.iconscout.com/icon/free/png-64/clock-1960-1119646.png',
			  body: message
			});

			notification.onclick = function () {};

		  }

		}
		function formatImporto(v){return v ? (""+v.toFixed(2)).replace(".",",")+" €" : "0,00 €"}
	</script>
	<script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart(lavoro, pausa) {
        var data = google.visualization.arrayToDataTable([
          ['Task', 'Ore'],
          ['Lavoro',     lavoro],
          ['Pausa',      pausa]
        ]);

        var options = {
          title: 'Attivita giornaliere'
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }
    </script>
  </body>
</html>
